# Panorama Project Audit Report (2026-02-09)

## 1. Audit Objective
Verify the current state of the Panorama repository (forked from Panorama) against existing planning documentation (primarily `PROJECT_OVERVIEW.md`) and identify mismatches or missing core components.

## 2. Evidence of Existing Capabilities (Panorama Base)

The repository already contains a sophisticated market data and FX infrastructure that was partially overlooked in prior planning documents.

### 2.1 Market Data Infrastructure
- **Core Service**: `src-core/src/market_data/market_data_service.rs` implements `MarketDataServiceTrait` with support for symbol search, latest quotes, and historical data syncing.
- **Provider Registry**: `src-core/src/market_data/providers/provider_registry.rs` manages multiple data sources.
- **Existing Providers**:
  - **Yahoo Finance**: `src-core/src/market_data/providers/yahoo_provider.rs` (Supports HK/US stocks, ETFs).
  - **Alpha Vantage**: `src-core/src/market_data/providers/alpha_vantage_provider.rs`.
  - **MarketData.app**: `src-core/src/market_data/providers/marketdata_app_provider.rs`.
  - **MetalPriceAPI**: `src-core/src/market_data/providers/metal_price_api_provider.rs`.
- **UI Settings**: `src/pages/settings/market-data/market-data-settings.tsx` provides a full UI for enabling/disabling providers and managing API keys.
- **Secret Storage**: Uses `SecretStore` + system keyring for secure API key storage.

### 2.2 FX & Exchange Rates
- **Core Service**: `src-core/src/fx/fx_service.rs` manages currency conversions.
- **Quotes Integration**: Migrated to a unified "Quotes" system via migration `2025-01-27-000001_migrate_fx_to_quotes`.
- **UI Settings**: `src/pages/settings/general/exchange-rates/exchange-rates-settings.tsx` handles manual and provider-based FX rates.

### 2.3 Database & Migrations
- **Market Data Providers Table**: Created via `2025-06-27-145729_create_market_data_providers_table`.
- **Historical Quotes**: Well-supported in the schema.

---

## 3. Mismatches & Corrections

| Claim in Prior Docs | Reality in Codebase | Correction |
|---------------------|----------------------|------------|
| "A股价格API 完全缺失" | ✅ **Confirmed** | Need a new `MarketDataProvider` (e.g., AKShare/Sina). |
| "港股/美股价格API 完全缺失"| ❌ **Incorrect** | `YahooProvider` and `AlphaVantageProvider` already exist. |
| "基金净值API 完全缺失" | ✅ **Confirmed** | Need a new `MarketDataProvider` for CN Funds (e.g., TianTian). |
| "API配置页面缺失" | ❌ **Incorrect** | `MarketDataSettingsPage` exists and is functional. |
| "MPF/保险账户类型缺失" | ✅ **Confirmed** | Native support is missing; requires extension. |

---

## 4. Delta List (What Panorama Still Needs)

To achieve the "All-in-One" vision, the following gaps must be closed:

1.  **CN A-share Provider**: A new Rust provider implementation using Sina or EastMoney public APIs (no API key required).
2.  **CN Fund NAV Provider**: A new Rust provider implementation using TianTian Fund API.
3.  **Insurance Module**: 
    - UI: New page to manage policies.
    - Data: Reuse `assets.attributes` (JSON) to store policy-specific fields (guaranteed value, insurer, etc.) to avoid complex schema changes.
4.  **MPF Module**:
    - UI: New page for MPF account view.
    - Data: Similar to Insurance, use `attributes` and existing `assets` table.
5.  **Multi-Owner Support**: Add an `owner` field/attribute to distinguish between "Self" and "Spouse" assets.

## 5. Audit Conclusion
The project is starting from a much stronger foundation than previously assumed. The "Market Data Service" and "FX Service" are largely complete. The focus of Panorama should shift from "building a price service" to "extending the provider registry" and "creating specialized UI modules for Insurance/MPF".

---
*Generated by Panorama Audit Tool - 2026-02-09*
